# エリックエヴァンス ドメイン駆動設計 第6回
## 第11章 アナリシスパターンを適用する
### どんな章？
過去の知識など( **アナリシスパターン** )からドメインや設計を発展させられることも
あるとして、会計アプリケーションにアナリシスパターンを適用してドメインモデルを
リファクタリングしていく感動ドキュメンタリー。

### アナリシスパターンとは
* Martin Fowlerが書いた本
  - [アナリシスパターン―再利用可能なオブジェクトモデル](https://www.amazon.co.jp/dp/4894716933)
* ビジネスモデリングにおける共通の構造を表す概念のグループ
  - 適切な状況で用いれば実践的(らしい)
* 特定のドメインモデルを考え出すのを支援する手引き
* 調査に対して有用な手がかりを与え、明確に抽象化された語彙を提供してくれる

### 会計アプリケーションへのアナリシスパターンの適用例
* アナリシスパターンを読んだら彼女ができましたみたいな感じ。

### アナリシスパターン適用時の注意点など
* アナリシスパターンの用語を使用する場合には、そのパターンによって規定される基本的な概念を注意深く元のまま保つこと
  - Why?
    + アナリシスパターンは、将来問題を避ける上で助けになるような理解を組み込んでいるかもしれない
    + ユビキタス言語に含まれている用語が広く理解されているか、少なくともうまく説明されているのであれば、そのユビキタス言語は強化される

### 感想
* エンタープライズアプリケーションアーキテクチャパターンも書いたMargin Fowlerがまた出てきた
* アナリシスパターンの原初は1996年に発行されてるようでそこそこ古め
  - Kindle版は翻訳版ないっぽく原的に厳しい
  - ググると難しいとかあんま実践的じゃないとか言われてる
* ファッション用にアナリシスパターンの本買っておいてもいいかも？
* よく意味がわからんかったこと
  - `ユビキタス言語に含まれている用語が広く理解されているか、少なくともうまく説明されているのであれば、そのユビキタス言語は強化される`
    + ???
    + つまり、アナリシスパターンで用いられる用語はいろんな知見を通じて最強に見えるからあんま変な手を加えんなってこと？？
    + 原文

      ```text
      注意すべき変更が1種類ある。よく知られたアナリシスパターンの用語を使用する場合には、そのパターンによって規定される基本的な概念を、注意深く元のままに保つこと。
      表面的な形式がどれほど変わっても、そうしなければならないのだ。
      その理由は2つある。
      第一に、そのパターンは、将来問題を避ける上で助けになるような理解を組み込んでいるかもしれない。
      第二に、こちらのほうが重要なのだが、ユビキタス言語に含まれている用語が広く理解されているか、少なくともうまく説明されているのであれば、そのユビキタス言語は強化される
      モデルの自然な進化を通じてモデルの定義が変化するなら、その名前も変更する手間を惜しまないこと
      ```


## 第12章 デザインパターンをモデルに関係づける
### どんな章？
デザインパターンとドメインパターンの違いと、ドメインモデルに適用可能なデザインパターンの紹介


### ドメインパターン
* エンティティとか値オブジェクト、凝集がどーとか、サービス・リポジトリ・ファクトリみたいな奴らのことかな？
  - ちゃんと明記されてない(これまで本書で探求してきたパターンとか言ってる)ので多分そうだろうという推測
  - 第9章,第10章あたりで説明されたものも含まれるかな

### デザインパターン
* あるレベルまで抽象化されたパターンに専念されいてる
* オブジェクトやクラスをコミュニケーションすることに関する記述
* 一般的な設計の問題を特定のコンテキストで解決するためにカスタマイズされている

### ドメインモデルに適用可能なデザインパターン
詳しくはデザインパターンを読めって感じ

**デザインパターンをドメインに適用する場合は、パターンの考え方が本当にドメインの概念に合うかどうかを気にしろ**

#### ストラテジパターン
* 簡単に処理を変えたいぜ！

#### コンポジットパターン
* 木構造な関連をいい感じに扱うぜ！

### 感想
* 急にドメインパターンとか言う単語が出てきて困惑
* ていうか、結局ドメインパターンとデザインパターンの違いをちゃんと書いてなくね？
  - デザインパターン
    + 様々な場面で頻繁に直面する問題を解決するパターン化したもの
  - ドメインパターン
    + もう少し具体的なもの？
* ドメインモデル作ってるときに、無駄にデザインパターン適用させようとするのはやめようね！


## 第13章 より深い洞察へ向かうリファクタリング
### どんな章？
ドメインモデルをリファクタリングする際に気をつけることやその手順など。

**直前の5章では、リファクタリングの応用的な見方を、従来のマイクロリファクタリングのアプローチに重ねて示してきた**

### リファクタリグのために取り組むべきこと
* ドメインに馴染む
* 物事に対して違う見方をする
* ドメインエキスパートとの対話を途切れさせない

### リファクタリングをどの様に開始するか
* コードの問題(複雑さやぎこちなさ)への対応
* 学習の結果

### モデルの改良方法の探求
* すぐ気づけて数時間で終わるようなものもあれば、より長くたくさんの人々が必要なものもある
* ブレストとコーディングを繰り返す
  - 参加者
    + 開発者
    + その種の問題を考え抜くことを得意とすること
    + ドメインの中の該当する領域に精通している人
    + 強力なモデリングスキルを持ってる人
  - 内容
    + UML図のスケッチ
    + オブジェクトを使用してシナリオのウォークスルー
* ブレスト時のポイント
  - **自主的な意思決定**
    + 少人数のチームでやる？
    + 長期的な手の込んだ組織構造は不要
  - **スコープと休憩**
    + 数日間隔を空けて、短いミーティングを2, 3回行う
    + 行き詰まるようなら一度に多くをやりすぎているかも
  - **ユビキタス言語の駆使**
    + 他のチームメンバや主題のエキスパートに参加してもらい、ユビキタス言語の改良の機会を作る
    + 開発者は生まれたユビキタス言語をコードの中で形式化する

### 開発者のための設計
* **ソフトウェアはユーザだけのためのものではなく、開発者のためのものでもある**
  - 他のシステムとの結合
  - 繰り替えしのコード変更
* 深い洞察へ向かうリファクタリングは、しなやかな設計とその恩恵を与える

### リファクタリングのタイミング
* 変更を完全に正当化できるまで待つのはまちすぎる
  - 完全にそれが正しいと言い切れるまで動かないみたいな？
* **設計をぎこちないままにしておくリスクと、その設計をなんとかするためのコスト** は発見し辛い
* リファクタリングの正当性の証明を求められることも多く、それがリファクタリングの抑圧になる傾向がある
  - 変更することで得られる利益や、変更しないことで生じるコストは予測可能なものではない
* リファクタリングを行うタイミング
  - **設計がドメインに関するチームの現在の理解を表現していない**
  - **重要な概念が設計で暗黙的になっている(かつそれを明示的にする方法がわかっている)**
  - **設計において重要な部分をよりしなやかにする好機がある**
* **リファクタリングは積極的な姿勢で取り組むべきだが、好き放題やっていいというわけではない**
  - リリース前日にやるな
  - ドヤ顔で技術アッピル披露のためにやるな

### 感想
* 深い洞察へ向かうリファクタリング = より本質を捉えたモデリング？
* しなやかな設計 = 応用力のある、簡潔で、変更可能な設計？
* 13章は個人的には第3部の中では一番おもろかったかも？？

## その他、第3部の全体的なこととか
* ダレる章が多かった
* 解説されている内容が特定のケースに限るものが多く、実際に業務などで適用させようとしたとき、じゃあ結局どうすればいいの？ってなるかも。
* 実際にコードを使った例もあったが、それ自体は別段変わったことをやっておらず、他の専門書などに比べると内容も薄いため、なんとなく消化不良
* あまり何度も繰り返して読むような部じゃないかな？？
  - 13章は割と啓発的な意味で読んだりしてもいいかも
* **[実践ドメイン駆動設計](https://www.amazon.co.jp/dp/479813161X)** をはしりくらいまで読んだけどなんか良さそうな気配を感じた。
  - なるべくエリックエヴァンスのDDD本に従って書いてるらしく、実は組み合わせて読むのが正解だったり？？
