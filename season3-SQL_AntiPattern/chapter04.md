# 第4章 キーレスエントリ(外部キー嫌い)
| -        | -                |
|:---------|:-----------------|
| タイトル | SQLアンチパターン  |
| 起票日   | 2019/06/15       |
| 起票者   | itor319          |
| 機能     | FOREIGN KEY　周り|

## 現象と期待動作
### 原因
- 外部キー制約がサポートされていない製品を使用している。
- 極端に柔軟なDB設計を扱わなければならない。
- パフォーマンスの影響。
- 構文を調べなきゃいかん。
- データの更新と衝突する。

## 対処方法
外部キー制約は使いましょう。

しっかり設計して、外部キーを用いれば妥当でない変更は勝手に拒否されるので、  
使わないで整合性取るためのコードがいらない！  
つまり全体のコード量が減る！  
つまりバグが減る！  
HAPPY！

## 使わないとこうなるぞってパターン
- 参照整合性を損なわれる事を避けるためのコードが必要になる。
 - 事前にSELECT流して存在を確認してからUPDATEするとか
 - ↑のことやってる間は関連するテーブルをロックしなきゃいかんとか
 - 人の手でそんな完全完璧なコード用意できませんよねェ！
- ミスを調べるためにあらゆるテーブルに対して似たようなコードが必要になる。
 - これらを毎日流したりして壊れたデータがないかチェックするのイヤだなぁ…イヤじゃない？

## でも使うとこうなるぞってやつ
- とあるレコードを削除しようとしたら外部キーで引っ掛かってエラーになる。
 - まず子側を消してねってめんどくせーなぁってなる

## 外部キー使ったら困るやつをなんとかするやつ
CASCADE句やRESTRICT句を使うとよしなにしてくれたりするらしいよ！
