# エリックエヴァンス ドメイン駆動設計 第17回
## 第16章 大規模な構造
### Outline
巨大なシステムにおいては、個別のドメインのモデル化に成功したとしても、全体を貫くポリシーがなければモデルは使い物にならない。
各モデルがどのように結びつきやコンテキストが追えなくなり、統合することができなくなってしまう。
なので、システムを貫くルールやパターンを定義することが大切である。

たぶん、これを極端に推し進めると、規約ガチガチのRoRとかになるんだと思う。

### 進化する秩序
設計に制約がなければ、システムの全体像の見通しが悪くなり、保守するのも困難になる。
逆に、アーキテクチャをガチガチにしてしまうと仕様変更に弱く、特定の箇所に負担のかかる作りとなってしまう。
なので、構造はドメインとともに進化させる必要がある。一貫したつくりだと構造変更もしやすい。

注意点
- 一部の特異な構造を全体に適用しない
- 特異なケースが発生しても対応できる余地を残しておかないといけない
- 無理に構造を適用しない。適切な構造が見つからない場合もある

### システムのメタファ
抽象的で認識しにくいドメインや構造を比喩を使って表すことで、認識を共有しやすくなる。

注意点
- メタファはドメインを正確に表しているわけではない
- 直感的にわかりやすいメタファに引きずられてはならない
- 必要に応じてユビキタス言語に取り入れる

### 責務のレイヤ
システムを横断する自然なドメインの階層。機能ではなく、責務による上位・下位の依存関係が広い範囲で認められる。
レイヤの上位、下位はシステム観点ではなく、経営の意思決定観点による。

大規模な構造に対してレイヤを適用することで、依存関係がしやすくなり、理解を促すことができる。
システムを横断する自然な階層が認められたら、責務をまとめたり分割したりして、そのレイヤに収まるようにする。

#### レイヤが保持すべき特徴
- ストーリーテリング  
レイヤはドメインの関心事項を表さなくてはならない。

- 概念的な依存関係  
上位の概念は下位の概念に依存するが、下位の概念は上位に依存せず、単独の意味を持つ。

- 概念の輪郭  
モデルの変化のスピードや原因が異なる場合。

#### モデル内のレイヤ
- 潜在能力（Capability）  
モデルが何をすることができるかを表すレイヤ

- 業務 （Operation） 
モデルが何をしているのかを表すレイヤ

- 意思決定支援
- ポリシー
- 確約
潜在能力と業務のレイヤを補完するレイヤ。潜在能力と業務に依存する。存在しないこともある。
ちょっとうまくまとめられない。。。
というか、業務部分が肥大化したから分割しただけ？

### 知識レベル
他のオブジェクトグループがどう振る舞うべきかを知っている。
というか、`Knowledge`を知識って訳すのがあまりよろしくない気がする。。。

責務レイヤのポリシーとは異なる。双方向の場合は知識レベル、下位層が上位層から独立している場合はポリシー。
なんとなーく分かった気がするけど、、、。単純に選ぶだけのポリシー比べて、実際はかなりインテリジェンスな作りになりそう。（なんとなく）

### 着脱可能コンポーネントのフレームワーク
ハブに繋げられるプロトコルを定義することで、コンポーネント同士を接続することができる。
まぁ、その通りなんだけど、これを一発目で仕留めるのは至難だよね。
