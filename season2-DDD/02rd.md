# 第2部 モデル駆動設計の構成要素
~~ドメイン駆動設計は種々のオブジェクト指向設計のデザインパターンを結びつける。各デザインパターンの原理原則から逸脱しても立ち戻り、現実解を導出するためには、~~  
ドメイン駆動設計を自然に表現し、豊かにするために、オブジェクト指向設計やその他のデザインパターンをうまく使おうぜ。
それぞれのデザインパターンの何がモデル駆動設計を支えているのかを理解する必要がある。

## 4章 ドメインを隔離する
ソフトウェアの構成要素の一部であるドメインオブジェクトが、ソフトウェアの他のオブジェクト（F/W等の他の機能の関心ごとなど）に埋もれてしまわないよう分離する必要がある。

### レイヤー化アーキテクチャ
知らぬ間にビジネスオブジェクト（ドメイン）以外の部分にビジネスロジックが紛れ込むこと（またはその逆）が多々あるから、対策が必要。一般的なのがレイヤー化すること。
あらゆるレイヤー化手法があるが、`レイヤ内のどの要素も同じレイヤの他の要素か、その"下にある"レイヤの要素にしか依存しない`という点においてみな共通している。

- ユーザインタフェース（プレゼンテーション層）
- アプリケーション層
- ドメイン層（モデル層）
- インフラストラクチャ層

#### どこから設計するのか（理想）
ドメイン層から設計をして、そこからUIやテーブル構成が構築されていくのが理想よね。

##### CF)クリーンアーキテクチャ
クリーンアーキテクチャをそのままWEB開発に落とし込むと、色々と面倒なので、以下のようなレイヤ構成にすると幸せ。
- アダプタ層
- ユースケース層
- エンティティ層
- ドライバ層

レイヤー化することで保守性が上がる
- 凝集度が高まる
- 各レイヤーのオブジェクトが責務に集中できる
- 各レイヤーが別々の速度で進化する傾向がある

#### 凝集度
モジュール（オブジェクト）に含まれる機能の純粋さ。高い方がよい。
#### 結合度
モジュール同士の関係の密接さ。低い方が良い。

- クリーンアーキテクチャってレイヤー化に輪をかけて規制が厳しいよね。。。

### 利口なUI「アンチパターン」
めっちゃあるある。
- Fatコントローラ
- 画面数＝機能数というスタンス

## 5章 ソフトウェアで表現されたモデル
- 関連
- Entity
- ValueObject
- Service
- Module

### 関連
現実世界の関連は複雑（N:N,双方向）なので、以下の方法で制約を設けることでモデル間の関連をスッキリさせる。
- 方向を一方向に強制する
- 多重度を減らす（1:Nにしたり）
- 不要な関連を除去する

### Entity
同一性を担保する。（連続性）
今までのEntityの説明の中で一番しっくりきたよ。。。

- 圏論とか知っておいた方がいい気がしてきた。集合と型を定義したり関連づけたりする学問のようだ
    - [圏論勉強会](http://nineties.github.io/category-seminar/1.html)
    - [圏論勉強会（動画）](https://www.youtube.com/watch?v=uWST7UivqeM)

### ValueObject
同一性を追跡する必要のないモデル要素で、属性にのみ関心があるオブジェクト。凝集度が高くなるよう設計する。  
コピーしたり共有したりはできるが、イミュータブルな作りにすること。（例外あり）  
とはいえ、VOは数が多くなりやすいオブジェクトなので、パフォーマンスの問題にもなりやすい。システム構成や言語などの環境でうまく使い分けてちょ。

- `public static String XXX`みたいな定数や`enum`も一種のVOということっぽい
    - DIする必要がある＝サービスとエンティティ、DIの必要はない＝VOということでもある？
    - VOは`enum`や`map(dictionary)`で、サービスとエンティティはDIで生成するっていう指針を作っても良さそう（->Repositoryやファクトリとの関係を重視した上で考えること）
- エンティティを維持するために必要となる複雑な設計を避けるってあるけど、エンティティの同一性担保にVOを使うのはNGってこと？（P97太字）

ドメインはルールだから、定数をドメイン層に入れるのはOKだと思う。が、定数はVOだという感じで決めつけるものではない。ドメイン分析の結果、定数が出てくるだけ。

エンティティの同一性を作り出すのが重要な事項。属性か関連するものか。

 - あとで、VOとエンティティは実際に作ってみたい

### Service
確かにドメインだけれども、エンティティやVOに入れるには違和感のあるものはサービスとして切り出す。  
ドメインのサービスが他のレイヤのサービスと混ざらないように気をつける。

#### サービスの特徴
- 抽象的なインターフェイスを提供
- 状態を持たない

設計時に気になる部分でもあるし、必要なのもわかる。だけれども、アプリケーションサービスとの違いがちょっとわかりにくかったりと、うまく誤魔化された感じがする。
- ドメインからボトムアップで構築されたものがドメインのサービス、アプリケーションの定義とは別。
- クリーンアーキテクチャのユースケースに該当する概念では？

サービスの派生する過程を追うために、実装しながら深掘りするのもいいかもね。

### Module
モジュール間は疎結合、モジュール内は凝集度が高い。
モジュールはPJ開始時の名残が残りやすい。外部との関連も大きくなる。歯を食いしばりながら、リファクタリング頑張ろう。

凝集度単位で作る場合、ドメインモデルが大きくなった時に問題が発生しやすい経験則。
名前単位で切るのもあり。（最初は）

### モデリングパラダイム
うまくやりましょう。
